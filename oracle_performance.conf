# Oracle Database 23c 性能优化配置
# 
# 适用于: 企业级高性能应用
# 内存: 64GB
# CPU: 14 cores
# 存储: NVMe SSD with ASM

# ===================================================================
# 内存管理参数
# ===================================================================

# SGA (System Global Area) 配置
# 设置为可用内存的 50%
sga_target = 32G
sga_max_size = 32G

# PGA (Program Global Area) 配置
# 设置为可用内存的 25%
pga_aggregate_target = 16G
pga_aggregate_limit = 24G

# 自动内存管理 (如果启用)
# memory_target = 48G
# memory_max_target = 48G

# 共享池配置
shared_pool_size = 8G
shared_pool_reserved_size = 800M

# 数据库缓冲区缓存
db_cache_size = 16G

# 大池配置
large_pool_size = 2G

# Java 池配置
java_pool_size = 512M

# 流池配置
streams_pool_size = 1G

# ===================================================================
# 进程和会话参数
# ===================================================================

# 最大进程数
processes = 1000

# 最大会话数
sessions = 1500

# 事务限制
transactions = 1650

# ===================================================================
# I/O 和存储参数
# ===================================================================

# 数据库写入进程数
db_writer_processes = 8

# 日志写入进程配置
lgwr_io_slaves = 4

# 异步 I/O
disk_asynch_io = true

# 数据文件 I/O 奴隶进程
dbwr_io_slaves = 4

# ===================================================================
# 日志和归档参数
# ===================================================================

# 归档模式
log_archive_mode = 'ARCHIVELOG'
log_archive_dest_1 = 'LOCATION=/opt/oracle/archive'
log_archive_format = 'arch_%t_%s_%r.arc'

# 重做日志配置
log_buffer = 256M
log_checkpoint_interval = 0
log_checkpoint_timeout = 1800

# 快速恢复区
db_recovery_file_dest = '/opt/oracle/fast_recovery_area'
db_recovery_file_dest_size = 50G

# ===================================================================
# 并发和锁参数
# ===================================================================

# DML 锁数量
dml_locks = 10000

# DDL 锁超时
ddl_lock_timeout = 60

# 分布式锁超时
distributed_lock_timeout = 60

# ===================================================================
# 优化器参数
# ===================================================================

# 优化器模式
optimizer_mode = 'ALL_ROWS'

# 优化器特性启用
optimizer_features_enable = '23.1.0'

# 统计信息自动收集
statistics_level = 'TYPICAL'

# 游标共享
cursor_sharing = 'EXACT'

# ===================================================================
# 网络和连接参数
# ===================================================================

# 连接超时
sqlnet_expire_time = 10

# TCP 连接有效性检查
tcp_connect_delay = 0

# ===================================================================
# 安全参数
# ===================================================================

# 审计
audit_trail = 'OS'

# 密码验证
sec_case_sensitive_logon = true

# ===================================================================
# 自动工作负载仓库 (AWR) 参数
# ===================================================================

# AWR 快照间隔 (分钟)
# exec dbms_workload_repository.modify_snapshot_settings(interval => 30);

# AWR 保留期 (天)
# exec dbms_workload_repository.modify_snapshot_settings(retention => 14);

# ===================================================================
# 自动数据库诊断监控 (ADDM) 参数
# ===================================================================

# 启用 ADDM 分析
control_management_pack_access = 'DIAGNOSTIC+TUNING'

# ===================================================================
# 并行执行参数
# ===================================================================

# 并行服务器进程数
parallel_servers_target = 64
parallel_max_servers = 128

# 默认并行度
parallel_degree_policy = 'MANUAL'
parallel_degree_limit = 'CPU'

# 并行执行消息大小
parallel_execution_message_size = 16384

# ===================================================================
# 闪回和版本控制参数
# ===================================================================

# 闪回数据库
db_flashback_retention_target = 1440

# 撤销管理
undo_management = 'AUTO'
undo_tablespace = 'UNDOTBS1'
undo_retention = 3600

# ===================================================================
# 高级功能参数
# ===================================================================

# 结果缓存
result_cache_mode = 'MANUAL'
result_cache_max_size = 2G

# 数据库智能闪存缓存 (如果有闪存存储)
# db_flash_cache_file = '/dev/flash_device'
# db_flash_cache_size = 32G

# 列存储
# inmemory_size = 8G
# inmemory_query = 'ENABLE'

# ===================================================================
# 数据库选项配置
# ===================================================================

# 启用高级压缩
# 需要 Advanced Compression 选项
db_block_compression = 'MEDIUM'

# 启用 HCC (Hybrid Columnar Compression)
# 需要 Exadata 或兼容存储
# db_block_compression = 'QUERY_HIGH'

# ===================================================================
# 性能监控参数
# ===================================================================

# 定时统计
timed_statistics = true

# SQL 跟踪
sql_trace = false
max_dump_file_size = '10240'

# 事件 10046 (SQL 跟踪)
# alter session set events '10046 trace name context forever, level 12';

# ===================================================================
# 资源管理器参数
# ===================================================================

# 资源管理器计划
# resource_manager_plan = 'DEFAULT_PLAN'

# CPU 计数
cpu_count = 14

# ===================================================================
# 备份和恢复参数
# ===================================================================

# 控制文件自动备份
control_file_record_keep_time = 31

# 备份优化
backup_tape_io_slaves = true

# ===================================================================
# 集群配置 (RAC 环境)
# ===================================================================

# 如果使用 RAC，取消注释以下参数
# cluster_database = true
# cluster_database_instances = 2
# instance_number = 1  # 对于实例 1
# thread = 1           # 对于实例 1

# ===================================================================
# 字符集和国际化
# ===================================================================

# 国家字符集
nls_characterset = 'AL32UTF8'
nls_nchar_characterset = 'AL16UTF16'

# 时区文件版本
timezone_file_dest = '/opt/oracle/product/23.0.0/dbhome_1/oracore/zoneinfo'

# ===================================================================
# 诊断参数
# ===================================================================

# 诊断目标
diagnostic_dest = '/opt/oracle/diag'

# 跟踪文件大小限制
max_dump_file_size = 'UNLIMITED'

# 后台转储目标
background_dump_dest = '/opt/oracle/diag/rdbms/orcl/orcl/trace'

# 用户转储目标
user_dump_dest = '/opt/oracle/diag/rdbms/orcl/orcl/trace'

# ===================================================================
# 网络配置建议 (tnsnames.ora)
# ===================================================================

# ORCL =
#   (DESCRIPTION =
#     (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
#     (CONNECT_DATA =
#       (SERVER = DEDICATED)
#       (SERVICE_NAME = orcl)
#       (INSTANCE_NAME = orcl)
#     )
#   )

# ===================================================================
# 监听器配置建议 (listener.ora)
# ===================================================================

# LISTENER =
#   (DESCRIPTION_LIST =
#     (DESCRIPTION =
#       (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
#       (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
#     )
#   )

# SID_LIST_LISTENER =
#   (SID_LIST =
#     (SID_DESC =
#       (SID_NAME = orcl)
#       (ORACLE_HOME = /opt/oracle/product/23.0.0/dbhome_1)
#       (PROGRAM = oracle)
#     )
#   )